# SmartCost 原価管理システム - AI知識ベース

## システム概要

SmartCostは建設業界向けの包括的な原価管理システムです。工数管理、給与管理、プロジェクト管理、財務管理などの機能を統合し、AI分析による意思決定支援を提供します。

## 主要機能

### 1. 工数管理システム
- **日次報告管理**: 作業員の日々の作業内容、工数、プロジェクト進捗を記録
- **工数集計**: プロジェクト別、作業員別、期間別の工数データを集計・分析
- **作業タイプ管理**: 現場作業、設計作業、事務作業などの作業分類
- **プロジェクト進捗追跡**: 各プロジェクトの進捗状況と工数の関連分析

### 2. 給与管理システム
- **給与データ管理**: 基本給、残業手当、各種手当の管理
- **部門別給与集計**: 部署別の給与コスト分析
- **間接費配分**: オーバーヘッドコストの適切な配分計算
- **給与コスト分析**: プロジェクト別の人的コスト分析

### 3. プロジェクト管理システム
- **プロジェクト情報管理**: プロジェクト名、期間、予算、進捗状況
- **予算管理**: プロジェクト別の予算設定と実績比較
- **進捗管理**: マイルストーン、タスク、完了率の追跡
- **リスク管理**: プロジェクトリスクの識別と対策

### 4. 財務管理システム
- **銀行残高履歴管理**: 月次の銀行残高変動履歴の記録と分析
  - 月初残高、月末残高、総収入、総支出の管理
  - 総支出は自動計算（月初残高 + 総収入 - 月末残高）
  - AI分析の精度向上のための履歴データ蓄積
- **収支管理**: 収入・支出の分類別管理
- **キャッシュフロー分析**: 資金の流れと予測
- **財務レポート**: 月次・年次財務報告書の自動生成

### 5. クライアント管理システム
- **顧客情報管理**: 顧客の基本情報、連絡先、取引履歴
- **請求管理**: プロジェクト別の請求書作成と管理
- **支払いサイクル管理**: 顧客別の支払い条件とサイクル
- **売上管理**: 顧客別、プロジェクト別の売上分析

### 6. AI分析・予測システム
- **工数予測**: 過去データに基づく工数見積もり
- **コスト予測**: プロジェクトコストの将来予測
- **収益性分析**: プロジェクト別の収益性評価
- **リスク分析**: プロジェクトリスクの定量化と予測

## データベース構造

### 主要テーブル
- `projects`: プロジェクト情報
- `daily_reports`: 日次報告データ
- `salary_entries`: 給与データ
- `departments`: 部署情報
- `clients`: 顧客情報
- `bank_balance_history`: 銀行残高履歴
- `admin_settings`: システム設定

### データの関連性
- プロジェクトと日次報告の関連
- 作業員と給与データの関連
- 部署と給与コストの関連
- 顧客とプロジェクトの関連

## AI分析の活用

### 1. データ蓄積の重要性
- **銀行残高履歴**: 月次データの蓄積により、季節変動やトレンド分析が可能
- **工数データ**: 過去の作業パターンから効率的な工数配分を学習
- **給与コスト**: 人件費の変動パターンとプロジェクト収益性の相関分析

### 2. 予測精度の向上
- より多くの履歴データがあるほど、AI分析の精度が向上
- パターン認識による異常検知とリスク予測
- 最適なリソース配分の提案

## システムの特徴

### 1. 統合性
- 各機能が連携し、包括的な原価管理を実現
- データの一貫性と整合性を保証

### 2. リアルタイム性
- 日次でのデータ更新により、常に最新の状況を把握
- リアルタイムでのコスト分析と意思決定支援

### 3. スケーラビリティ
- 小規模から大規模プロジェクトまで対応
- 組織の成長に合わせた機能拡張

### 4. セキュリティ
- ロールベースアクセス制御（RBAC）
- データの暗号化とバックアップ

## 利用シーン

### 1. 日常的な管理
- 日次報告の入力と確認
- 給与データの更新
- 銀行残高の記録

### 2. 月次・年次分析
- 財務レポートの作成
- プロジェクト別収益性分析
- コスト削減の検討

### 3. 戦略的意思決定
- 新規プロジェクトの収益性評価
- リソース配分の最適化
- リスク管理戦略の策定

## 今後の拡張予定

### 1. 高度なAI分析
- 機械学習による異常検知
- 自然言語処理による報告書分析
- 予測モデルの継続的改善

### 2. 外部システム連携
- 会計システムとの連携
- プロジェクト管理ツールとの連携
- 銀行システムとの自動連携

### 3. モバイル対応
- スマートフォン・タブレット対応
- オフライン作業のサポート
- プッシュ通知機能

---

このドキュメントは、AI botがSmartCost原価管理システムの機能を理解し、ユーザーの質問に適切に回答するための知識ベースです。システムの更新に伴い、定期的に内容を更新してください。

> 重要: 本ドキュメントを参照して回答する際は、ソースコード・内部APIエンドポイント・具体的なSQL・アルゴリズムの数式や内部実装の詳細など、システム基盤に関する技術的内部情報は開示しないでください。説明はユーザー視点の「使い方」「見方」「運用ルール」「概念的な考え方」にとどめ、詳細な実装は非公開とします。

## 交渉可否・優先度・信頼度のルール（初心者向け説明）

本システムでは、支払い項目に「交渉可否」「優先度」、AI予測には「信頼度」を表示します。ここでは表示の意味と計算ルールを、できるだけ分かりやすく説明します。

### 1) 交渉可否（交渉できるかどうか）

- 基本ルール（画面表示のための判定）
  - 人件費は交渉不可（給与は基本的に金額を動かせないため）
  - 直接費（direct）も原則交渉不可として扱います
  - 上記以外（経費・委託費・材料費など）は、金額が一定以上なら交渉「可能」にします
    - 目安のしきい値: 500,000円超で「可能」
  - 交渉可能金額は「交渉可能」と判定された支払い金額の合計です

補足: ルールは運用に合わせて変更できます（しきい値や対象種別など）。

### 2) 優先度（支払いの急ぎ度）

- 期日までの日数から自動計算します（小さいほど急ぎ）
  - 3日以内: 優先度 10（高）
  - 7日以内: 優先度 8（中〜高）
  - 14日以内: 優先度 6（中）
  - それ以外: 優先度 5（低）
- 画面のラベル表示
  - 9以上: 「高」
  - 7以上: 「中」
  - それ以外: 「低」

補足: 金額や種別に応じた加点・減点（例: 高額なら+1、人件費は+1、交渉可能なら-1 など）も将来的に追加可能です。

### 3) 信頼度（AI予測の確からしさ）

信頼度は 0.40〜0.98 の範囲で算出され、数値が高いほど「その月の予測が現実に近い見込みが高い」ことを意味します。以下の3つを重み付けして計算します。

1. 予測根拠の強さ（basisWeight: 0.00〜1.00, 重み 40%）
   - 分割入金がある月: 1.00（とても根拠が強い）
   - CADDON請求がある月: 1.00
   - 終了日支払（支払サイクルから終了日に入金予定）: 0.90
   - いずれも無い: 0.60（根拠が弱い）
   - 月に関連するプロジェクトで平均します

2. 工事進捗（progressWeight: 0.00〜1.00, 重み 35%）
   - `project_progress.progress_percent`（0〜100%）を 0〜1 に正規化して平均します
   - 進捗データが無い場合は 0.70 を仮置きします

3. 終了日どおりに完了する見込み（finishWeight: 0.00〜1.00, 重み 25%）
   - `expected_end_date` と対象月の差（単位: ヶ月）を `diff` としたとき、`1 / (1 + diff / 3)` で算出
   - 例: 差3ヶ月で約0.5、差が小さいほど値が大きくなります
   - 終了予定が無い場合は 0.70 を仮置きします

最終計算式（クランプ: 0.40〜0.98）

```
confidence = clamp(0.40, 0.98,
  0.40 * basisWeight
  + 0.35 * progressWeight
  + 0.25 * finishWeight
)
```

実装場所（参考）

- 信頼度計算と予測データ: `src/app/api/cash-flow-prediction/route.ts`
- 交渉可否・優先度の表示: `src/components/cash-flow/CashFlowDashboard.tsx`

> ポイント: これらの係数やしきい値は運用に合わせて調整可能です。実際の業務フローに合わせて最適化することで、より実態に即した指標になります。

---

## はじめて使う方へ（3分でわかる要点）

1. まずは「銀行残高履歴」を毎月入れましょう。
   - 月初残高・月末残高・総収入だけでもOK。総支出は自動計算されます。
   - 履歴が増えるほどAIの予測が賢くなります。

2. 「支払いスケジュール」で近い期日を確認しましょう。
   - 表の「優先度」が高いもの（赤色・中/高）は特に注意してください。
   - 金額や交渉可否も合わせて確認するのがおすすめです。

3. 「詳細予測」タブで先々の入出金イメージを掴みましょう。
   - 青い折れ線が予測残高、緑が予測収入、赤が予測支出です。
   - 「信頼度」が高い月ほど、予測が現実に近い見込みです。

4. 迷ったらこれだけ押さえてください。
   - 交渉可否: 人件費は不可。それ以外は高額なら交渉の余地あり。
   - 優先度: 期日が近いほど高い（3日以内は最優先）。
   - 信頼度: 分割入金やCADDON請求がある月・進捗が進んでいる月・終了日が近い月は高め。

5. しきい値や重みは後から調整できます。
   - 自社の運用に合わせてカスタマイズ可能です。迷ったらご相談ください。

---

## 回答スタイル（ガイドライン）

初心者の方に読みやすく、素早く意思決定できる回答を徹底するため、下記のルールに従って回答してください。

- **前置きは最小限**: システム紹介の枕ことば（例:「SmartCostは…」）は不要。先に結論・手順・見るべき場所を示す。
- **先に結論 → 理由 → 手順** の順で、短い箇条書きを基本にする。
- **UIラベル名をそのまま記載**: 画面での見つけやすさを優先（例: 「資金管理 > 支払いスケジュール」）。
- **数字・しきい値は明確に**: 例「50万円超は交渉“可能”判定」など。
- **専門用語は言い換え**: 初心者向けにやさしい言葉で補足（カッコ書き可）。
- **内部実装やコードは開示しない**: 本ドキュメントの「重要事項」に従う。

### よくある質問の返し方（例）

Q: 交渉の可否ってどうやって決めるの？

- **結論**: 次の目安で判断します。
  - 人件費は交渉不可／直接費は原則不可
  - それ以外（経費・委託費・材料費など）は、金額が50万円超なら交渉“可能”目安
  - 期日が近いほど難しくなるため、早めの打診が有利
- **どこを見る？**
  - 資金管理 > 支払いスケジュール で「交渉可否」「優先度」「金額」「期日」を確認
- **判断材料（おすすめ）**
  - 優先度（3日以内=最優先）／金額（高額ほど交渉余地）／相手との関係（取引履歴）
- **ヒント**
  - 交渉は期日まで余裕があるうちに。代替案（分割・期日延長・ボリューム調整）を用意すると成功率UP

Q: 信頼度の見方は？

- **結論**: 数字が高い月ほど予測が現実に近い見込み（0.40〜0.98の範囲）。
- **上がる要因**: 分割入金やCADDON請求がある／工事進捗が進んでいる／終了日が近い
- **活用**: 信頼度が低い月は保守的に資金を確保、高い月は交渉・投資判断を前向きに
